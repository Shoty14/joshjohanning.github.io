<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="The Easiest Way to Generate and Publish .NET Code Coverage in Azure DevOps" /><meta name="author" content="Josh Johanning" /><meta property="og:locale" content="en" /><meta name="description" content="Publishing Code Coverage and making it look pretty in Azure DevOps is way harder than it should be" /><meta property="og:description" content="Publishing Code Coverage and making it look pretty in Azure DevOps is way harder than it should be" /><link rel="canonical" href="https://josh-ops.com/posts/azure-devops-code-coverage/" /><meta property="og:url" content="https://josh-ops.com/posts/azure-devops-code-coverage/" /><meta property="og:site_name" content="josh-ops" /><meta property="og:image" content="https://josh-ops.com/assets/screenshots/2021-09-03-azure-devops-code-coverage/good-code-coverage.png" /><meta property="og:image:height" content="582" /><meta property="og:image:width" content="816" /><meta property="og:image:alt" content="Cobertura Code Coverage in Azure DevOps" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-03T04:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://josh-ops.com/assets/screenshots/2021-09-03-azure-devops-code-coverage/good-code-coverage.png" /><meta name="twitter:image:alt" content="Cobertura Code Coverage in Azure DevOps" /><meta property="twitter:title" content="The Easiest Way to Generate and Publish .NET Code Coverage in Azure DevOps" /><meta name="twitter:site" content="@jjjettrain" /><meta name="twitter:creator" content="@Josh Johanning" /><meta name="google-site-verification" content="google-site-verification=eTIC71VhPBtwll8rNv7qlXud1yJh6E88No39MdcM_MI" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Josh Johanning"},"dateModified":"2022-07-01T15:39:30-05:00","datePublished":"2021-09-03T04:00:00-05:00","description":"Publishing Code Coverage and making it look pretty in Azure DevOps is way harder than it should be","headline":"The Easiest Way to Generate and Publish .NET Code Coverage in Azure DevOps","image":{"width":816,"height":582,"alt":"Cobertura Code Coverage in Azure DevOps","url":"https://josh-ops.com/assets/screenshots/2021-09-03-azure-devops-code-coverage/good-code-coverage.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://josh-ops.com/posts/azure-devops-code-coverage/"},"url":"https://josh-ops.com/posts/azure-devops-code-coverage/"}</script><title>The Easiest Way to Generate and Publish .NET Code Coverage in Azure DevOps | josh-ops</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="josh-ops"><meta name="application-name" content="josh-ops"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/sample/headshot.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">josh-ops</a></div><div class="site-subtitle font-italic">A DevOps Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-comment ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/joshjohanning" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/jjjettrain" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/joshua-johanning/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>The Easiest Way to Generate and Publish .NET Code Coverage in Azure DevOps</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>The Easiest Way to Generate and Publish .NET Code Coverage in Azure DevOps</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1630659600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 3, 2021 </em> </span> <span> Updated <em class="" data-ts="1656707970" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 1, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 816 582'%3E%3C/svg%3E" data-src="/assets/screenshots/2021-09-03-azure-devops-code-coverage/good-code-coverage.png" class="preview-img bg" alt="Cobertura Code Coverage in Azure DevOps" width="816" height="582" data-proofer-ignore><figcaption class="pt-2 pb-2">Cobertura Code Coverage in Azure DevOps</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> Josh Johanning </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1047 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h2 id="overview"><span class="mr-2">Overview</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Publishing code coverage in Azure DevOps and making it look pretty is way harder than it should be. It’s something that sounds simple, oh just check the box on the task - but nope you have to make sure to read the notes and add the additional parameter to the test task. Okay great, now you have a code coverage tab, but what is this .coverage file and how do I open it? That’s not very user friendly. And don’t get me started on having to wait for the <em>entire</em> pipeline to finish before you can even <em>see</em> the code coverage tab - nonsensical.</p><p>If you want to navigate to the solution, <a href="#the-better-way">scroll down</a>.</p><h2 id="not-good-the-out-of-the-box-way"><span class="mr-2">Not Good: The Out of the Box Way</span><a href="#not-good-the-out-of-the-box-way" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If using the out of the box <code class="language-plaintext highlighter-rouge">dotnet</code> task with the <code class="language-plaintext highlighter-rouge">test</code> command, simply add the <code class="language-plaintext highlighter-rouge">publishTestResults</code> argument (or if using the task assistant, check the <code class="language-plaintext highlighter-rouge">Publish test results and code coverage</code> checkbox): <img data-src="/assets/screenshots/2021-09-03-azure-devops-code-coverage/adding-test-task.png" alt="adding dotnet test task" width="350" class="shadow" data-proofer-ignore> <em>.NET Core Task Assistant UI</em></p><p>However, if you read the information on the <code class="language-plaintext highlighter-rouge">publishTestResults</code> argument from the <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/build/dotnet-core-cli?view=azure-devops#arguments">.NET Core CLI task</a> (or clicking on the <code class="language-plaintext highlighter-rouge">(i) </code> on the <code class="language-plaintext highlighter-rouge">Publish test results and code coverage</code> option in the task assistant), it says:</p><blockquote><p>Enabling this option will generate a test results TRX file in <code class="language-plaintext highlighter-rouge">$(Agent.TempDirectory)</code> and results will be published to the server. This option appends <code class="language-plaintext highlighter-rouge">--logger trx --results-directory $(Agent.TempDirectory)</code> to the command line arguments.</p><p><strong>Code coverage can be collected by adding <code class="language-plaintext highlighter-rouge">--collect "Code coverage"</code> option to the command line arguments. This is currently only available on the Windows platform.</strong></p></blockquote><p>Emphasis: mine. So even if you check the box, you need to ensure you add the <code class="language-plaintext highlighter-rouge">--collect "Code coverage"</code> argument. Oh, and you have to run this on a Windows agent, so no <code class="language-plaintext highlighter-rouge">ubuntu-latest</code> for us.</p><p>This produces code coverage that looks like the following in Azure DevOps: <img data-src="/assets/screenshots/2021-09-03-azure-devops-code-coverage/bad-code-coverage.png" alt=".coverage file code coverage" width="400" class="shadow" data-proofer-ignore> <em>How the default code coverage in Azure DevOps looks</em></p><p>It’s a link to a .coverage file..which is great if you 1) have Visual Studio installed and 2) are on Windows (can’t open .coverage file on Mac).</p><h2 id="the-better-way"><span class="mr-2">The Better Way</span><a href="#the-better-way" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The better way is to add the <a href="https://github.com/coverlet-coverage/coverlet">coverlet.collector</a> NuGet package to (each of) the test project(s) that you run <code class="language-plaintext highlighter-rouge">dotnet test</code> against.</p><p>The easiest way to do this is to run the <code class="language-plaintext highlighter-rouge">dotnet package add</code> command targeting the test project:</p><p><code class="language-plaintext highlighter-rouge">dotnet add &lt;TestProject.cspoj&gt; package coverlet.collector</code></p><p><img data-src="/assets/screenshots/2021-09-03-azure-devops-code-coverage/dotnet-add-package.png" alt="dotnet add package" class="shadow" data-proofer-ignore> <em>Adding coverlet.collector with dotnet add package</em></p><p>For those who can’t run the <code class="language-plaintext highlighter-rouge">dotnet</code> command, add the <a href="https://github.com/joshjohanning/PrimeService-unit-testing-using-dotnet-test/commit/43067b4e035eb45899e185e701bd4aaf8575514b">following</a> under the <code class="language-plaintext highlighter-rouge">ItemGroup</code> block in the <code class="language-plaintext highlighter-rouge">.csproj</code> file:</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"coverlet.collector"</span> <span class="na">Version=</span><span class="s">"3.1.0"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;IncludeAssets&gt;</span>runtime; build; native; contentfiles; analyzers; buildtransitive<span class="nt">&lt;/IncludeAssets&gt;</span>
      <span class="nt">&lt;PrivateAssets&gt;</span>all<span class="nt">&lt;/PrivateAssets&gt;</span>
    <span class="nt">&lt;/PackageReference&gt;</span>
</pre></table></code></div></div><p>See the <a href="https://www.nuget.org/packages/coverlet.collector/">following page</a> for the latest version.</p><p>Next, update the pipeline to ensure your <code class="language-plaintext highlighter-rouge">dotnet test</code> command looks like mine, and adding the <code class="language-plaintext highlighter-rouge">PublishCodeCoverageResults@1</code> task.</p><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>    <span class="c1"># Add coverlet.collector nuget package to test project - 'dotnet add &lt;TestProject.cspoj&gt; package coverlet.collector'</span>
    <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">DotNetCoreCLI@2</span>
      <span class="na">displayName</span><span class="pi">:</span> <span class="s">dotnet test</span>
      <span class="na">inputs</span><span class="pi">:</span>
        <span class="na">command</span><span class="pi">:</span> <span class="s1">'</span><span class="s">test'</span>
        <span class="na">projects</span><span class="pi">:</span> <span class="s1">'</span><span class="s">**/*.Tests.csproj'</span>
        <span class="na">arguments</span><span class="pi">:</span> <span class="s1">'</span><span class="s">--configuration</span><span class="nv"> </span><span class="s">$(buildConfiguration)</span><span class="nv"> </span><span class="s">--collect:"XPlat</span><span class="nv"> </span><span class="s">Code</span><span class="nv"> </span><span class="s">Coverage"'</span>
        <span class="na">publishTestResults</span><span class="pi">:</span> <span class="no">true</span>

    <span class="c1"># Publish code coverage report to the pipeline</span>
    <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">PublishCodeCoverageResults@1</span>
      <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Publish</span><span class="nv"> </span><span class="s">code</span><span class="nv"> </span><span class="s">coverage'</span>
      <span class="na">inputs</span><span class="pi">:</span>
        <span class="na">codeCoverageTool</span><span class="pi">:</span> <span class="s">Cobertura</span>
        <span class="na">summaryFileLocation</span><span class="pi">:</span> <span class="s">$(Agent.TempDirectory)/*/coverage.cobertura.xml</span> <span class="c1"># using ** instead of * finds duplicate coverage files</span>
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">--collect:"XPlat Code Coverage"</code> argument is what tells <code class="language-plaintext highlighter-rouge">dotnet test</code> to use the <code class="language-plaintext highlighter-rouge">coverlet.collector</code> package to generate us a cobertura code coverage report. As you can guess by the <code class="language-plaintext highlighter-rouge">XPlat</code> in the argument, this runs cross platform on both Windows and Ubuntu.</p><p>This argument creates a <code class="language-plaintext highlighter-rouge">$(Agent.TempDirectory)/*/coverage.cobertura.xml</code> code coverage report file. This folder is default output folder since Azure DevOps adds <code class="language-plaintext highlighter-rouge">--results-directory /home/vsts/work/_temp</code> to the command.</p><p>Next, we have to specifically add the <code class="language-plaintext highlighter-rouge">PublishCodeCoverageResults@1</code> task to publish the code coverage output to the pipeline. It seems like at least with my project, it produces 2 <code class="language-plaintext filepath highlighter-rouge">coverage.cobertura.xml</code> files and that throws a warning in the pipeline, so that’s I used <code class="language-plaintext highlighter-rouge">$(Agent.TempDirectory)/*/coverage.cobertura.xml</code> not <code class="language-plaintext highlighter-rouge">$(Agent.TempDirectory)/**/coverage.cobertura.xml</code></p><p><img data-src="/assets/screenshots/2021-09-03-azure-devops-code-coverage/find-code-coverage.png" alt="duplicate code coverage reports" class="shadow" data-proofer-ignore> <em>Duplicate coverage.cobertura.xml code coverage results</em></p><p>Now, after the <em>entire</em> pipeline has finished (including any of the deployment stages), we will have a code coverage tab with a way more visually appealing code coverage report: <img data-src="/assets/screenshots/2021-09-03-azure-devops-code-coverage/good-code-coverage.png" alt="cobertura code coverage in azure devops" class="shadow" data-proofer-ignore> <em>Cobertura Code Coverage Report in Azure DevOps</em></p><h2 id="why-not-reportgenerator"><span class="mr-2">Why not ReportGenerator?</span><a href="#why-not-reportgenerator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I’ve seen many blog posts that are similar to mine, except that they have the <code class="language-plaintext highlighter-rouge">reportgenerator@4</code> task. I used to think this was required, too! But I have recently found out it is not - at least not if you have <strong>ONE</strong> test project you are publishing results for.</p><p>If you have multiple test projects you would like code coverage published for, then yes, the <code class="language-plaintext highlighter-rouge">reportgenerator@4</code> task is needed.</p><p>I have started to use the command line instead of the actual <code class="language-plaintext highlighter-rouge">reportgenerator@4</code> task itself, though, as not every organization has the <a href="https://marketplace.visualstudio.com/items?itemName=Palmmedia.reportgenerator">marketplace extension installed</a> (and some have stricter policies about adding extensions than others).</p><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>    <span class="c1"># First install the tool on the machine, then run it</span>
    <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">dotnet tool install -g dotnet-reportgenerator-globaltool</span>
        <span class="s">reportgenerator -reports:$(Agent.WorkFolder)/**/coverage.cobertura.xml -targetdir:$(Build.SourcesDirectory)/CodeCoverage -reporttypes:'HtmlInline_AzurePipelines;Cobertura'</span>
      <span class="na">displayName</span><span class="pi">:</span> <span class="s">Create code coverage report</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">reportgenerator@4</code> equivalent:</p><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>      <span class="c1"># ReportGenerator extension to combine code coverage outputs into one</span>
      <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">reportgenerator@4</span>
        <span class="na">inputs</span><span class="pi">:</span>
          <span class="na">reports</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(Agent.WorkFolder)/**/coverage.cobertura.xml'</span>
          <span class="na">targetdir</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(Build.SourcesDirectory)/CoverageResults'</span>
</pre></table></code></div></div><p>This needs to run before the <code class="language-plaintext highlighter-rouge">PublishCodeCoverageResults@1</code> task, and that task needs to be updated just a little bit (the xml file path is different). See:</p><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>      <span class="c1"># Publish the combined code coverage to the pipeline</span>
      <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">PublishCodeCoverageResults@1</span>
        <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Publish</span><span class="nv"> </span><span class="s">code</span><span class="nv"> </span><span class="s">coverage</span><span class="nv"> </span><span class="s">report'</span>
        <span class="na">inputs</span><span class="pi">:</span>
          <span class="na">codeCoverageTool</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Cobertura'</span>
          <span class="na">summaryFileLocation</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(Build.SourcesDirectory)/CoverageResults/Cobertura.xml'</span>
          <span class="na">reportDirectory</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(Build.SourcesDirectory)/CoverageResults'</span>
</pre></table></code></div></div><h2 id="code-coverage-tab-not-showing-up"><span class="mr-2">Code Coverage Tab Not Showing Up?</span><a href="#code-coverage-tab-not-showing-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This doesn’t really solve the <a href="https://developercommunity.visualstudio.com/t/code-coverage-does-not-show-up-until-multistage-pi/786733">problem</a> where Azure DevOps will not show the Code Coverage tab until the <em>entire</em> pipeline (including all deployments) has completed. In cases where code coverage is important, I either:</p><ol><li>Change the report output from <code class="language-plaintext highlighter-rouge">$(Build.SourcesDirectory)</code> to <code class="language-plaintext highlighter-rouge">$(Build.ArtifactStagingDirectory)</code> and <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=azure-devops&amp;tabs=schema%2Cparameter-schema#publish">publish</a> the report as a pipeline artifact.<li>Create a <em>separate</em> build pipeline than deployment pipeline. This harkens back to the day where we didn’t have multi-stage YAML builds and we had separate Build Definitions and Release Definitions. We can set up the deployment yml pipeline to be <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/pipeline-triggers?tabs=yaml&amp;view=azure-devops#configure-pipeline-resource-triggers">triggered</a> from the completion of the build yml pipeline.</ol><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now you know the ins and outs of adding Code Coverage to your .NET (Core) projects in Azure DevOps.</p><p>Stay tuned to my next post on what we can do with code coverage in GitHub Actions!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/azure-devops/'>Azure DevOps</a>, <a href='/categories/pipelines/'>Pipelines</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/azure-devops/" class="post-tag no-text-decoration" >Azure DevOps</a> <a href="/tags/code-coverage/" class="post-tag no-text-decoration" >Code Coverage</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=The+Easiest+Way+to+Generate+and+Publish+.NET+Code+Coverage+in+Azure+DevOps+-+josh-ops&url=https%3A%2F%2Fjosh-ops.com%2Fposts%2Fazure-devops-code-coverage%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=The+Easiest+Way+to+Generate+and+Publish+.NET+Code+Coverage+in+Azure+DevOps+-+josh-ops&u=https%3A%2F%2Fjosh-ops.com%2Fposts%2Fazure-devops-code-coverage%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fjosh-ops.com%2Fposts%2Fazure-devops-code-coverage%2F&text=The+Easiest+Way+to+Generate+and+Publish+.NET+Code+Coverage+in+Azure+DevOps+-+josh-ops" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fjosh-ops.com%2Fposts%2Fazure-devops-code-coverage%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/github-container-jobs/">Docker Container Jobs in GitHub Actions</a><li><a href="/posts/actions-runner-controller-without-cert-manager/">Configure actions-runner-controller without cert-manager</a><li><a href="/posts/azdo-commit-message-validator-and-pr-linker-github-action/">Azure DevOps Commit Message Validator and PR Linker GitHub Action</a><li><a href="/posts/azure-devops-migrate-work-items/">Azure DevOps: Migrate Work Items to New Organization / Project</a><li><a href="/posts/github-misc-scripts/">Miscellaneous GitHub API/GraphQL/CLI Automation Scripts</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/github-actions/">GitHub Actions</a> <a class="post-tag" href="/tags/pull-requests/">Pull Requests</a> <a class="post-tag" href="/tags/github-advanced-security/">GitHub Advanced Security</a> <a class="post-tag" href="/tags/scripts/">Scripts</a> <a class="post-tag" href="/tags/work-items/">Work Items</a> <a class="post-tag" href="/tags/branch-protection-rules/">Branch Protection Rules</a> <a class="post-tag" href="/tags/dependabot/">Dependabot</a> <a class="post-tag" href="/tags/codeql/">CodeQL</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/extends-template/"><div class="card-body"> <em class="small" data-ts="1607659200" data-df="ll" > Dec 10, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Azure DevOps: Extends Template with Build and Deployment Templates</h3><div class="text-muted small"><p> Scenario I had a client that wanted to integrate a secret scanning utility (among other checks) into the pipeline, and enforce this control. Colin Dembovsky (my co-worker) and I typically recommen...</p></div></div></a></div><div class="card"> <a href="/posts/angular-tokenization/"><div class="card-body"> <em class="small" data-ts="1623972600" data-df="ll" > Jun 17, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tokenizing Angular Environment Configuration in Azure DevOps</h3><div class="text-muted small"><p> Overview I was working with a team that had an Angular front-end application and I was tasked with improving their CI/CD process. They had some automated pipelines, but they were running a build b...</p></div></div></a></div><div class="card"> <a href="/posts/pipeline-templates/"><div class="card-body"> <em class="small" data-ts="1628827200" data-df="ll" > Aug 12, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Azure DevOps: Pipeline Templates</h3><div class="text-muted small"><p> Overview Although linked in various posts in this blog, I never fully advertise my pipeline-templates GitHub repository. I refer back to this every so often to see how I accomplished something in ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/agent-pool-error/" class="btn btn-outline-primary" prompt="Older"><p>Azure DevOps: No agent pool found with identifier xx</p></a> <a href="/posts/github-code-coverage/" class="btn btn-outline-primary" prompt="Newer"><p>GitHub Actions: Publish Code Coverage Summary to Pull Requests</p></a></div><script src="https://utteranc.es/client.js" repo="joshjohanning/joshjohanning.github.io" issue-term="title" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/joshjohanning">Josh Johanning</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/github-actions/">GitHub Actions</a> <a class="post-tag" href="/tags/pull-requests/">Pull Requests</a> <a class="post-tag" href="/tags/github-advanced-security/">GitHub Advanced Security</a> <a class="post-tag" href="/tags/scripts/">Scripts</a> <a class="post-tag" href="/tags/work-items/">Work Items</a> <a class="post-tag" href="/tags/branch-protection-rules/">Branch Protection Rules</a> <a class="post-tag" href="/tags/dependabot/">Dependabot</a> <a class="post-tag" href="/tags/codeql/">CodeQL</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GE92ZJY22K"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GE92ZJY22K'); }); </script>
