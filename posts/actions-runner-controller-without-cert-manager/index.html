<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Configure actions-runner-controller without cert-manager" /><meta name="author" content="Josh Johanning" /><meta property="og:locale" content="en" /><meta name="description" content="Configure actions-runner-controller without cert-manager so that you can use self-signed or self-managed certificates to scale your GitHub runners" /><meta property="og:description" content="Configure actions-runner-controller without cert-manager so that you can use self-signed or self-managed certificates to scale your GitHub runners" /><link rel="canonical" href="https://josh-ops.com/posts/actions-runner-controller-without-cert-manager/" /><meta property="og:url" content="https://josh-ops.com/posts/actions-runner-controller-without-cert-manager/" /><meta property="og:site_name" content="josh-ops" /><meta property="og:image" content="https://josh-ops.com/pods.png" /><meta property="og:image:height" content="100%" /><meta property="og:image:width" content="100%" /><meta property="og:image:alt" content="actions-runner-controller pods for our autoscaling GitHub runners" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-28T16:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://josh-ops.com/pods.png" /><meta name="twitter:image:alt" content="actions-runner-controller pods for our autoscaling GitHub runners" /><meta property="twitter:title" content="Configure actions-runner-controller without cert-manager" /><meta name="twitter:site" content="@jjjettrain" /><meta name="twitter:creator" content="@Josh Johanning" /><meta name="google-site-verification" content="google-site-verification=eTIC71VhPBtwll8rNv7qlXud1yJh6E88No39MdcM_MI" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Josh Johanning"},"dateModified":"2022-08-19T10:36:02-05:00","datePublished":"2022-06-28T16:00:00-05:00","description":"Configure actions-runner-controller without cert-manager so that you can use self-signed or self-managed certificates to scale your GitHub runners","headline":"Configure actions-runner-controller without cert-manager","image":{"width":"100%","height":"100%","alt":"actions-runner-controller pods for our autoscaling GitHub runners","url":"https://josh-ops.com/pods.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://josh-ops.com/posts/actions-runner-controller-without-cert-manager/"},"url":"https://josh-ops.com/posts/actions-runner-controller-without-cert-manager/"}</script><title>Configure actions-runner-controller without cert-manager | josh-ops</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="josh-ops"><meta name="application-name" content="josh-ops"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/sample/headshot.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">josh-ops</a></div><div class="site-subtitle font-italic">A DevOps Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-comment ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/joshjohanning" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/jjjettrain" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/joshua-johanning/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Configure actions-runner-controller without cert-manager</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Configure actions-runner-controller without cert-manager</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1656450000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 28, 2022 </em> </span> <span> Updated <em class="" data-ts="1660923362" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 19, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100% 100%'%3E%3C/svg%3E" data-src="/assets/screenshots/2022-06-28-actions-runner-controller-without-cert-manager/pods.png" class="preview-img bg" alt="actions-runner-controller pods for our autoscaling GitHub runners" width="100%" height="100%" data-proofer-ignore><figcaption class="pt-2 pb-2">actions-runner-controller pods for our autoscaling GitHub runners</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> Josh Johanning </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="904 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h2 id="overview"><span class="mr-2">Overview</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://github.com/actions-runner-controller/actions-runner-controller">actions-runner-controller</a> is a great way to set up self-scaling GitHub runners in a Kubernetes cluster. This allows teams to scale up their self-hosted runners as more jobs are queued throughout the day and scale down at night when there are fewer jobs running. There is a lot of documentation to digest in the repository, but for the most part, it’s relatively easy to get started with some basic scaling. The only prerequisite (other than having access to the Kubernetes cluster and administrative access to GitHub repo or organization) is <a href="https://cert-manager.io/docs/">cert-manager</a>.</p><p>However, sometimes organizations have their own certificate requirements, and prefer to manage their own certificates vs. letting a tool like cert-manager manage them. This is where the <a href="https://github.com/actions-runner-controller/actions-runner-controller#using-without-cert-manager">current documentation is lacking and unclear</a>. Other people have asked the <a href="https://github.com/actions-runner-controller/actions-runner-controller/issues?q=is%3Aissue+in%3Atitle+without+cert-manager+">same question</a>, as well as my most recent customer, and we were able to figure it out so I’ll document it here!</p><h2 id="configuring-without-cert-manager"><span class="mr-2">Configuring without cert-manager</span><a href="#configuring-without-cert-manager" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I’m going to be creating self-signed certificates, but you could imagine this working with certificates provided to you from the security team. If creating your own certificates, you will need <code class="language-plaintext highlighter-rouge">openssl</code> installed and callable via the command line.</p><p>1. Create RSA keys for CA cert and Server cert - this will output <code class="language-plaintext filepath highlighter-rouge">ca.key</code> and <code class="language-plaintext filepath highlighter-rouge">server.key</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>openssl genrsa <span class="nt">-out</span> ca.key 4096
openssl genrsa <span class="nt">-out</span> server.key 4096
</pre></table></code></div></div><p>2. Create a CA configuration file (<code class="language-plaintext filepath highlighter-rouge">ca.conf</code>) - the <code class="language-plaintext highlighter-rouge">basicConstraints</code> and <code class="language-plaintext highlighter-rouge">keyUsage</code> sections are required in order for the CA to be able to sign certificates</p><div file="ca.conf" class="language-config highlighter-rouge"><div class="code-header"> <span data-label-text="ca.conf"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="n">basicConstraints</span> = <span class="n">CA</span>:<span class="n">TRUE</span>
<span class="n">keyUsage</span> = <span class="n">cRLSign</span>, <span class="n">keyCertSign</span>
[<span class="n">req</span>]
<span class="n">distinguished_name</span> = <span class="n">req_distinguished_name</span>
<span class="n">prompt</span> = <span class="n">no</span>
[<span class="n">req_distinguished_name</span>]
<span class="n">C</span> = <span class="n">US</span>
<span class="n">ST</span> = <span class="n">SomeState</span>
<span class="n">L</span> = <span class="n">SomeCity</span>
<span class="n">O</span> = <span class="n">SomeOrg</span>
<span class="n">emailAddress</span> = <span class="n">your</span>@<span class="n">email</span>.<span class="n">com</span>
<span class="n">CN</span> = <span class="n">actionrunners</span>.<span class="n">yourorg</span>.<span class="n">com</span>
</pre></table></code></div></div><p>3. Create the CA certificate with the <code class="language-plaintext filepath highlighter-rouge">ca.conf</code> file - this will output <code class="language-plaintext filepath highlighter-rouge">ca.crt</code></p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>openssl req <span class="nt">-x509</span> <span class="nt">-new</span> <span class="nt">-sha512</span> <span class="nt">-nodes</span> <span class="nt">-key</span> ./ca.key <span class="nt">-days</span> 7307 <span class="nt">-out</span> ./ca.crt <span class="nt">-config</span> ./ca.conf
</pre></table></code></div></div><p>4. Optionally validate that the CA certificate created successfully</p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>openssl x509 <span class="nt">-noout</span> <span class="nt">-text</span> <span class="nt">-in</span> ./ca.crt
</pre></table></code></div></div><p>5. Create your Server certificate config file - ie <code class="language-plaintext filepath highlighter-rouge">server.cnf</code></p><ul><li>All 3 SANs (<code class="language-plaintext highlighter-rouge">alt_names</code>) are needed<li>For the 3rd <code class="language-plaintext highlighter-rouge">alt_name</code>, the <code class="language-plaintext highlighter-rouge">actions-runner-system</code> is the namespace - if you are installing into a different namespace, replace <code class="language-plaintext highlighter-rouge">actions-runner-system</code> with the namespace you are installing to (ie: <code class="language-plaintext highlighter-rouge">default</code>)</ul><div file="server.conf" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="server.conf"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>[req]
default_bits = 4096
prompt = no
default_md = sha256
x509_extensions = v3_req
distinguished_name = dn

[dn]
C = US
ST = SomeState
L = SomeCity
O = SomeOrg
emailAddress = your@email.com
CN = actionrunners.yourorg.com

[v3_req]
subjectAltName = @alt_names

[alt_names]
DNS.1 = webhook-service.actions-runner-system.svc
DNS.2 = webhook-service.actions-runner-system.svc.cluster.local
DNS.3 = actions-runner-controller-webhook.actions-runner-system.svc
</pre></table></code></div></div><p>6. Create the server Certificate Signing Request (csr) - this will outut <code class="language-plaintext filepath highlighter-rouge">server.csr</code></p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>openssl req <span class="nt">-new</span> <span class="nt">-key</span> ./server.key <span class="nt">-out</span> ./server.csr <span class="nt">-config</span> ./server.conf
</pre></table></code></div></div><p>7. Create your Server certificate - this will output <code class="language-plaintext filepath highlighter-rouge">server.crt</code></p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>openssl x509 <span class="nt">-req</span> <span class="nt">-in</span> ./server.csr <span class="nt">-CA</span> ./ca.crt <span class="nt">-CAkey</span> ./ca.key <span class="se">\</span>
  <span class="nt">-CAcreateserial</span> <span class="nt">-out</span> ./server.crt <span class="nt">-days</span> 10000 <span class="se">\</span>
  <span class="nt">-extensions</span> v3_req <span class="nt">-extfile</span> ./server.conf
</pre></table></code></div></div><p>8. Optionally inspect your Server cert to make sure it has the Subject Alternate Names (SANs, aka the <code class="language-plaintext highlighter-rouge">alt_names</code> from step #5)</p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>openssl x509 <span class="nt">-noout</span> <span class="nt">-text</span> <span class="nt">-in</span> ./server.crt
</pre></table></code></div></div><p>9. Base64 the CA cert and copy to clipboard (<code class="language-plaintext highlighter-rouge">pbcopy</code> is a macOS command, if running elsewhere just echo <code class="language-plaintext highlighter-rouge">$CA_BUNDLE</code> and copy)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">CA_BUNDLE</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>ca.crt | <span class="nb">base64</span><span class="si">)</span>
<span class="nb">echo</span> <span class="nv">$CA_BUNDLE</span> | pbcopy
</pre></table></code></div></div><p>10. Set the <code class="language-plaintext highlighter-rouge">admissionWebHooks.caBundle</code> value in the <code class="language-plaintext filepath highlighter-rouge">values.yaml</code> file to the base64 value of the CA cert - you may have to remove the extra <code class="language-plaintext highlighter-rouge">{}</code> under <code class="language-plaintext highlighter-rouge">admissionWebHooks</code></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="na">admissionWebHooks</span><span class="pi">:</span>
  <span class="c1"># {} # need to remove this</span>
  <span class="na">caBundle</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Ci0tL..."</span>
</pre></table></code></div></div><p>11. In the <code class="language-plaintext filepath highlighter-rouge">values.yaml</code> file, ensure <code class="language-plaintext highlighter-rouge">certManagerEnabled</code> is set to false</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="na">certManagerEnabled</span><span class="pi">:</span> <span class="no">false</span>
</pre></table></code></div></div><p>12. Create your certificate secrets using <code class="language-plaintext highlighter-rouge">kubectl</code> - both of these are needed</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>kubectl create secret tls webhook-server-cert <span class="nt">-n</span> actions-runner-system <span class="se">\</span>
  <span class="nt">--cert</span><span class="o">=</span>./server.crt  <span class="nt">--key</span><span class="o">=</span>./server.key
kubectl create secret tls actions-runner-controller-serving-cert <span class="nt">-n</span> actions-runner-system <span class="se">\</span>
  <span class="nt">--cert</span><span class="o">=</span>./server.crt  <span class="nt">--key</span><span class="o">=</span>./server.key
</pre></table></code></div></div><p>13. Run the <code class="language-plaintext highlighter-rouge">helm upgrade</code> command to install the controller</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>helm upgrade <span class="nt">--install</span> <span class="nt">--namespace</span> actions-runner-system <span class="nt">--create-namespace</span> <span class="se">\ </span>
  <span class="nt">--wait</span> actions-runner-controller actions-runner-controller/actions-runner-controller <span class="se">\</span>
  <span class="nt">--values</span> ./values.yaml
</pre></table></code></div></div><p>Note: Make sure to you have ran the <code class="language-plaintext highlighter-rouge">helm repo add</code> <a href="https://github.com/actions-runner-controller/actions-runner-controller#installation">command already</a></p><p>14. Ensure that your <code class="language-plaintext highlighter-rouge">actions-runner-controller</code> pod in the <code class="language-plaintext highlighter-rouge">actions-runner-system</code> namespace has started - if it fails, describe the pod and check the events</p><p>15. Deploy your runner configuration - <a href="https://gist.github.com/joshjohanning/4c4ccd3998d81552be940b07649d609a">my example</a> with org runners and metric-based scaling</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> runner.yaml <span class="nt">--namespace</span> default
</pre></table></code></div></div><p>16. Ensure that your runner pods have started (describe them if not); check GitHub to see if your runner(s) show there also</p><p>Here’s me running <a href="https://k9scli.io/"><code class="language-plaintext highlighter-rouge">k9s</code></a> to visualize the pods and ensure they are running: <img data-src="/assets/screenshots/2022-06-28-actions-runner-controller-without-cert-manager/pods.png" alt="Using k9s to ensure pods are running" class="shadow" data-proofer-ignore> <em>The controller running in the actions-runner-system namespace; the runner pods running in the default namespace</em></p><p>Corresponding runners show up as org runners in GitHub: <img data-src="/assets/screenshots/2022-06-28-actions-runner-controller-without-cert-manager/runners.png" alt="Org runners in GitHub" class="shadow" data-proofer-ignore> <em>Runners with the same name as the pod name show up as org runners in GitHub</em></p><h2 id="summary"><span class="mr-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://github.com/actions-runner-controller/actions-runner-controller">actions-runner-controller</a> is great, but sometimes you need some good trial-and-error to do things off the beaten path. Luckily, we were able to figure out how to configure the controller without using <a href="https://cert-manager.io/docs/">cert-manager</a> by interpreting the errors we saw when describing the failing pods.</p><p>As an enhancement, I could see you wanting a separate certificate for the <code class="language-plaintext highlighter-rouge">actions-runner-controller-serving-cert</code> and <code class="language-plaintext highlighter-rouge">webhook-server-cert</code> in step #12 - but I’ll leave further certificate optimizations to the certificate pros.</p><p>Feel free to ask any questions or share any enhancements!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/github/'>GitHub</a>, <a href='/categories/actions/'>Actions</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/github/" class="post-tag no-text-decoration" >GitHub</a> <a href="/tags/github-actions/" class="post-tag no-text-decoration" >GitHub Actions</a> <a href="/tags/actions-runner-controller/" class="post-tag no-text-decoration" >actions-runner-controller</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Configure+actions-runner-controller+without+cert-manager+-+josh-ops&url=https%3A%2F%2Fjosh-ops.com%2Fposts%2Factions-runner-controller-without-cert-manager%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Configure+actions-runner-controller+without+cert-manager+-+josh-ops&u=https%3A%2F%2Fjosh-ops.com%2Fposts%2Factions-runner-controller-without-cert-manager%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fjosh-ops.com%2Fposts%2Factions-runner-controller-without-cert-manager%2F&text=Configure+actions-runner-controller+without+cert-manager+-+josh-ops" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fjosh-ops.com%2Fposts%2Factions-runner-controller-without-cert-manager%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/github-container-jobs/">Docker Container Jobs in GitHub Actions</a><li><a href="/posts/actions-runner-controller-without-cert-manager/">Configure actions-runner-controller without cert-manager</a><li><a href="/posts/azdo-commit-message-validator-and-pr-linker-github-action/">Azure DevOps Commit Message Validator and PR Linker GitHub Action</a><li><a href="/posts/azure-devops-migrate-work-items/">Azure DevOps: Migrate Work Items to New Organization / Project</a><li><a href="/posts/github-misc-scripts/">Miscellaneous GitHub API/GraphQL/CLI Automation Scripts</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/github-actions/">GitHub Actions</a> <a class="post-tag" href="/tags/pull-requests/">Pull Requests</a> <a class="post-tag" href="/tags/github-advanced-security/">GitHub Advanced Security</a> <a class="post-tag" href="/tags/scripts/">Scripts</a> <a class="post-tag" href="/tags/work-items/">Work Items</a> <a class="post-tag" href="/tags/branch-protection-rules/">Branch Protection Rules</a> <a class="post-tag" href="/tags/dependabot/">Dependabot</a> <a class="post-tag" href="/tags/codeql/">CodeQL</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/gh-auth-login-in-actions/"><div class="card-body"> <em class="small" data-ts="1648486800" data-df="ll" > Mar 28, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to use gh auth login CLI Programmatically in GitHub Actions</h3><div class="text-muted small"><p> Overview Quick post here since I have to search for this every time I try to use the gh cli in GitHub Actions. In order to use the gh cli, you typically have to run gh auth login to authenticate. ...</p></div></div></a></div><div class="card"> <a href="/posts/authorize-azure-artifacts-in-github-actions/"><div class="card-body"> <em class="small" data-ts="1609791300" data-df="ll" > Jan 4, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Authorize and Restore Azure Artifacts NuGet Packages in GitHub Actions</h3><div class="text-muted small"><p> Summary While this post is geared towards Azure DevOps and Azure Artifacts, this approach will work for any third-party feed that requires authentication (like Artifactory!). I needed to be able ...</p></div></div></a></div><div class="card"> <a href="/posts/github-code-coverage/"><div class="card-body"> <em class="small" data-ts="1631156400" data-df="ll" > Sep 8, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GitHub Actions: Publish Code Coverage Summary to Pull Requests</h3><div class="text-muted small"><p> Overview This is a follow-up to my previous post: The Easiest Way to Generate and Publish .NET Code Coverage in Azure DevOps I was familiar with adding Code Coverage to my pipelines in Azure DevO...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/github-delete-branch-protection-rules/" class="btn btn-outline-primary" prompt="Older"><p>Delete GitHub Branch Protection Rules Programmatically</p></a> <a href="/posts/my-macos-development-environment/" class="btn btn-outline-primary" prompt="Newer"><p>My macOS Development Environment: iTerm2, oh-my-zsh, and VS Code</p></a></div><script src="https://utteranc.es/client.js" repo="joshjohanning/joshjohanning.github.io" issue-term="title" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/joshjohanning">Josh Johanning</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/github-actions/">GitHub Actions</a> <a class="post-tag" href="/tags/pull-requests/">Pull Requests</a> <a class="post-tag" href="/tags/github-advanced-security/">GitHub Advanced Security</a> <a class="post-tag" href="/tags/scripts/">Scripts</a> <a class="post-tag" href="/tags/work-items/">Work Items</a> <a class="post-tag" href="/tags/branch-protection-rules/">Branch Protection Rules</a> <a class="post-tag" href="/tags/dependabot/">Dependabot</a> <a class="post-tag" href="/tags/codeql/">CodeQL</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GE92ZJY22K"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GE92ZJY22K'); }); </script>
