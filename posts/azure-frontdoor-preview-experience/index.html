<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Azure Front Door Standard/Premium Preview - Tips, Tricks, and Lessons Learned" /><meta name="author" content="Josh Johanning" /><meta property="og:locale" content="en" /><meta name="description" content="I share my experience, lessons-learned, and tips and tricks for working with the new Azure Front Door Standard/Premium (Preview) SKUs" /><meta property="og:description" content="I share my experience, lessons-learned, and tips and tricks for working with the new Azure Front Door Standard/Premium (Preview) SKUs" /><link rel="canonical" href="https://josh-ops.com/posts/azure-frontdoor-preview-experience/" /><meta property="og:url" content="https://josh-ops.com/posts/azure-frontdoor-preview-experience/" /><meta property="og:site_name" content="josh-ops" /><meta property="og:image" content="https://josh-ops.com/assets/screenshots/2021-10-01-azure-frontdoor-preview-experience/front-door-overview-expanded.png" /><meta property="og:image:height" content="530" /><meta property="og:image:width" content="500" /><meta property="og:image:alt" content="Front Door Overview" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-01T16:30:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://josh-ops.com/assets/screenshots/2021-10-01-azure-frontdoor-preview-experience/front-door-overview-expanded.png" /><meta name="twitter:image:alt" content="Front Door Overview" /><meta property="twitter:title" content="Azure Front Door Standard/Premium Preview - Tips, Tricks, and Lessons Learned" /><meta name="twitter:site" content="@jjjettrain" /><meta name="twitter:creator" content="@Josh Johanning" /><meta name="google-site-verification" content="google-site-verification=eTIC71VhPBtwll8rNv7qlXud1yJh6E88No39MdcM_MI" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Josh Johanning"},"dateModified":"2022-07-01T15:39:30-05:00","datePublished":"2021-10-01T16:30:00-05:00","description":"I share my experience, lessons-learned, and tips and tricks for working with the new Azure Front Door Standard/Premium (Preview) SKUs","headline":"Azure Front Door Standard/Premium Preview - Tips, Tricks, and Lessons Learned","image":{"width":500,"height":530,"alt":"Front Door Overview","url":"https://josh-ops.com/assets/screenshots/2021-10-01-azure-frontdoor-preview-experience/front-door-overview-expanded.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://josh-ops.com/posts/azure-frontdoor-preview-experience/"},"url":"https://josh-ops.com/posts/azure-frontdoor-preview-experience/"}</script><title>Azure Front Door Standard/Premium Preview - Tips, Tricks, and Lessons Learned | josh-ops</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="josh-ops"><meta name="application-name" content="josh-ops"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/sample/headshot.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">josh-ops</a></div><div class="site-subtitle font-italic">A DevOps Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-comment ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/joshjohanning" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/jjjettrain" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/joshua-johanning/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Azure Front Door Standard/Premium Preview - Tips, Tricks, and Lessons Learned</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Azure Front Door Standard/Premium Preview - Tips, Tricks, and Lessons Learned</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1633123800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 1, 2021 </em> </span> <span> Updated <em class="" data-ts="1656707970" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 1, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 530'%3E%3C/svg%3E" data-src="/assets/screenshots/2021-10-01-azure-frontdoor-preview-experience/front-door-overview-expanded.png" class="preview-img bg" alt="Front Door Overview" width="500" height="530" data-proofer-ignore><figcaption class="pt-2 pb-2">Front Door Overview</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> Josh Johanning </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2428 words"> <em>13 min</em> read</span></div></div></div><div class="post-content"><h2 id="overview"><span class="mr-2">Overview</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I want to talk about Azure Front Door - not the old Azure Front Door - the new Azure Front Door, the new <a href="https://docs.microsoft.com/en-us/azure/frontdoor/standard-premium/overview">PREVIEW Front Door with the Standard/Premium SKUs</a>. But Josh, wait, this is a DevOps blog, why are you talking about Azure Front Door? Well, I had the <del>pleasure</del> experience of working with Front Door (Preview) on my most recent project, and thought I would be doing the world a disservice by not sharing a little bit of the <del>frustration</del> knowledge I have gained while working with it. Whether no one else is using this service or no one is talking about it, we struggled to find many resources online for how to do certain things in the Front Door (Preview), so this is where this article comes into play.</p><p>I am not planning on writing an entire how-to article, this is just intended to serve as a resource that hopefully the SEO Gods can help make someone else’s life easier. If you are unfamiliar with Azure Front Door (Preview), or want some official background and guidance from Microsoft, see the <a href="https://docs.microsoft.com/en-us/azure/frontdoor/standard-premium/overview">What is Azure Front Door Standard/Premium (Preview)?</a> page.</p><p>Note: For the purposes of this article, I am going to abbreviate Azure Front Door as AFD, and when I say AFD, I mean the new Preview Azure Front Door; I will not be referring to the classic / old Front door here.</p><p>(PS: Guinness Book of Records, see above for my submission on most times “Front Door” has been used in a single sentence)</p><h2 id="things-that-work-well"><span class="mr-2">Things That Work Well</span><a href="#things-that-work-well" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Private Endpoints<ul><li>Azure Front Door does a great job of routing to services such as App Services, Function Apps, Storage Accounts, and Private Link Services that are protected via Private Endpoints<li>Since these are ‘magic’ aka managed Private Endpoints, the Private Endpoint doesn’t live in your subscription and you don’t have access to it. Therefore, there doesn’t seem to be a way to get the Origin Group / Origin deployment to automatically approve these, so you have to remember to go to the target resource and approve the Private Endpoint manually. This is similar to how Azure Data Factory’s Private Endpoints work<li>Private Endpoints only work with the Premium SKU</ul><li>Certificates!<ul><li>Azure Front Door does a great job of automatically managing certificates - including expirations - the default setting is to let Azure Front Door handle all of this for you with 0 configuration<li>You still have the option to bring your own certificate by creating an Azure Front Door Secret linked to a Certificate in an Azure Key Vault - Azure Front Door even shows expiration of that certificate on the Domain page<li>If you are using your own certificate, it needs to be in PFX / PKCS 12 format (not PEM)</ul><li>Web Application Firewall (WAF)<ul><li>Anecdotally, I only have experience with the Premium SKU of the Azure Front Door Preview service, but <a href="https://docs.microsoft.com/en-us/azure/web-application-firewall/afds/waf-front-door-create-portal?toc=/azure/frontdoor/standard-premium/toc.json#default-rule-set-drs">creating a WAF tied to Microsoft-provided default rule set</a> is relatively simple<li>The Standard SKU does not let you use a WAF</ul><li>Letting teams share a single Front Door resource<ul><li>Teams can manage their own Endpoints in a single Azure Front Door resource without worry of mucking it up too much for other teams<li>This splits the <a href="https://azure.microsoft.com/en-us/pricing/details/frontdoor/">current $165/monthly cost</a> for the Premium SKU</ul><li>Linking Origin to just about any hostname<ul><li>Works great for serving static websites hosted in an Azure Storage Account - we created a static website container <code class="language-plaintext highlighter-rouge">$web</code> and set our Origin to <code class="language-plaintext highlighter-rouge">Origin Type: Custom</code> and <code class="language-plaintext highlighter-rouge">Host Name: mystaticsite.z21.web.core.windows.net</code><li>We got the idea from <a href="https://docs.rackspace.com/blog/azure-front-door-storage-static-website/">article as a basis for this static website setup</a> (okay this is referencing the Classic Azure Front Door, but the custom host name screenshot was what did the trick)<li>If using Private Endpoints, you still have to have Azure Front Door create a private endpoint to the storage account. We set the ‘target sub resource’ (aka <code class="language-plaintext highlighter-rouge">groupId</code> in the ARM/API) to <code class="language-plaintext highlighter-rouge">web</code>.<li>We did something similar with our Kubernetes linkage, creating a Private Link Service bound to the AKS managed subnet and Internal Load Balancer of our nginx service. In this pattern, the <code class="language-plaintext highlighter-rouge">Origin Type: Custom</code> and <code class="language-plaintext highlighter-rouge">Host Name</code> was set to the IP of the Internal Load Balancer and we used <code class="language-plaintext highlighter-rouge">null()</code> for our <code class="language-plaintext highlighter-rouge">Origin Host Header</code> and let nginx do header routing based on the URL that is being sent from Front Door to the Cluster. We set the ‘target sub resource’ (aka <code class="language-plaintext highlighter-rouge">groupId</code> in the ARM/API) to <code class="language-plaintext highlighter-rouge">null()</code>. See below <a href="#arm-null-property-and-terraform">example</a><li>Works as expected with App Services and Function Apps; just set <code class="language-plaintext highlighter-rouge">Origin Type: App Services</code></ul></ul><h2 id="things-that-dont-work-well"><span class="mr-2">Things That Don’t Work Well</span><a href="#things-that-dont-work-well" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Private Endpoints<ul><li>For about 3-4 weeks in July/early August, Azure Front Door’s Private Endpoints just completely died and Microsoft support was super slow in getting any attention to this. I get that it’s a Preview feature and things happen, but the resolution time was a little disappointing. We haven’t had any issues since they “reverted” the change that broke this, though<li>You have to manually approve the Private Endpoint on your target resource</ul><li>URL Rewriting<ul><li>We were trying to use a single Azure Front Door Endpoint to host all of our App Service APIs as Origins; sort of like a poor man’s APIM (around 18x cheaper if you’re not using all of the premium features of a Premium APIM)<li>We wanted <code class="language-plaintext highlighter-rouge">myfd.z01.azurefd.net/foo</code> to redirect to <code class="language-plaintext highlighter-rouge">foo.azurewebsites.net</code><li>Maybe we were just doing it wrong, but we struggled to do native URL Rewriting in Azure Front Door - it’s incredibly <del>possible</del> likely that we are just misinterpreting how it’s supposed to work<li>See my <a href="https://stackoverflow.com/questions/68564910/url-rewrite-in-azure-front-door-preview-standard-premium">Stack Overflow</a> post of what we were trying to do, and someone’s <a href="https://stackoverflow.com/a/68914412/4270353">suggestion</a> on how to resolve (I have not had a chance to test yet)<li>We instead did <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/url-rewriting?view=aspnetcore-5.0">URL Rewriting</a> by using middleware at the app level. It just requires a making a <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/url-rewriting?view=aspnetcore-5.0#url-redirect">small modification in the startup.cs file</a> (and if you’re serving a Swagger page, there too!). See: <a href="#url-rewrite">examples below</a><li>For Function Apps, there is no way to rewrite the incoming URL. However, you can edit the <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-http-webhook-output#hostjson-settings">host.json file and customize the base path</a> by modifying the <code class="language-plaintext highlighter-rouge">routePrefix</code> property. See: <a href="#function-apps---hostjson">example below</a></ul><li>Update Times<ul><li>Okay minor gripe, but it takes anywhere from <a href="https://docs.microsoft.com/en-us/azure/frontdoor/standard-premium/faq#how-long-does-it-take-to-deploy-an-azure-front-door-does-my-front-door-still-work-when-being-updated">5-20 minutes</a> for a change you make to Front Door to propagate down to you<li>Sometimes loading in a different browser / using a proxy can help alleviate cache/dns issues</ul><li><a href="https://github.com/hashicorp/terraform-provider-azurerm/issues/11983">No native Terraform Resource (yet)</a><ul><li>We are using the <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/template_deployment">azurerm_template_deployment</a> resource to deploy an ARM template within Terraform</ul><li>Editing via the UI<ul><li>You have to click the ‘Edit’ button on the Endpoint, then click into the Origin Group/Route to make changes - if you just click on the Origin Group/Route without clicking ‘Edit’ first, you will just be in a read only mode.</ul><li>WebSockets<ul><li><a href="https://github.com/MicrosoftDocs/architecture-center/issues/1891#issuecomment-918733057">Azure Front Door does not support WebSockets</a> - use Long Polling instead for SignalR use cases</ul></ul><h2 id="random-notes"><span class="mr-2">Random notes</span><a href="#random-notes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>HTTPS Redirect in .NET Web Apps<ul><li>It is considered best practice to redirect http to https. This can be done in the code by adding the following to the <code class="language-plaintext highlighter-rouge">startup.cs</code> file: <code class="language-plaintext highlighter-rouge">app.UseHttpsRedirection();</code><li>The problem with this method when using Azure Front Door with Private Endpoints is that this causes the app to redirect to the host (azurewebsites.net) instead of the incoming host URL (custom domain on Azure Front Door)<li>To work around this, you should remove this line of code altogether from the application and let Front Door redirect traffic to HTTPS (a setting on the Route)<li>If you’re working with an Angular app, make sure to remove any HTTPS redirect from the <code class="language-plaintext filepath highlighter-rouge">web.config</code></ul><li>Deleting Endpoints / Domains / Front Door<ul><li>If you want to delete a domain, you will need to clean up all of the associations (i.e.: the Route)<li>You can delete the entire Endpoint the domain is associated to as well<li>If there is/was a WAF associated to that endpoint, though, you need to manually go into the WAF resource and remove the association to the domain manually. This isn’t made clear by the UI error (<code class="language-plaintext highlighter-rouge">Failed to delete the custom domain(s)</code>) or the CLI error (<code class="language-plaintext highlighter-rouge">(BadRequest) Property 'AfdDomainEntityKey.AfdDomainName' cannot be set to 'mysubdomain.mydomain.com'.</code>)<li>If you go to re-create the Endpoint with the same name, note that it will fail for the first time with a <code class="language-plaintext highlighter-rouge">Conflict: That resource name isn't available</code> error message!!! You simply have to attempt to create the endpoint another time and then it will go through properly. The error will look something like this: <code class="language-plaintext highlighter-rouge">error": {\r\n "code": "Conflict",\r\n "message": "That resource name isn't available."</code><li>If you delete your entire Front Door, you still need to delete the WAF manually, and you will still see a <code class="language-plaintext highlighter-rouge">conflict</code> error message the first time you try to re-create a deleted endpoint</ul><li><code class="language-plaintext highlighter-rouge">Our services aren’t available right now</code> error<ul><li>Make sure you have approved the Private Endpoint on the target resource<li>Alternatively, go and edit the Origin Group &gt; Origin, uncheck the Private Endpoint box, save the Origin, Save the Origin Group, wait 10-30 seconds for it to apply, edit the Origin Group &gt; Origin, check the Private Endpoint box and select the right resource, save the Origin, save the Origin Group, and go and re-approve the Private Endpoint on the target resource</ul><li><code class="language-plaintext highlighter-rouge">&lt;h2&gt;Our services aren't available right now&lt;/h2&gt;&lt;p&gt;We're working to restore all services as soon as possible.</code> error<ul><li>Your endpoint is still provisioning<li>Or, your Route is misconfigured<li>The HTML will be not be rendered on the page for this error - if it does render it means Front Door is routing correctly it’s likely a problem with a private endpoint (see above)</ul><li><code class="language-plaintext highlighter-rouge">Page not found</code> blue page error<ul><li>Wait 5-20 minutes for the Endpoint to provision</ul><li>Sometimes CORS errors disguise themselves as a misconfigured Endpoint / Private Endpoint<li>Be familiar with <a href="https://social.technet.microsoft.com/wiki/contents/articles/51140.azure-rest-management-api-the-quickest-way-to-get-your-bearer-token.aspx">grabbing a Bearer token to interact directly with the Azure REST APIs</a><ul><li>As an example, you can plug that Bearer token into Postman and use this <code class="language-plaintext highlighter-rouge">GET</code> request to list the details about a Origin in an Origin Group:<div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">  GET https://management.azure.com/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/my-afd-rg/providers/Microsoft.Cdn/profiles/my-afd/originGroups/myorigingroup/origins?api-version=2020-09-01&amp;Full
</span></pre></table></code></div></div><li>This can also be helpful when deciphering what changes / values you need to use in an ARM template</ul></ul><h2 id="summary"><span class="mr-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Hopefully I haven’t scared you away; Azure Front Door (Preview) has a lot of great features and shows a lot promise! And when it works, it works real well. Half of the frustration that we had with this service was that no one else had written about it, so we were kind of making it up as we go along. We have a solid foundation now, and once there is a native Terraform module, making changes for us will be even easier.</p><p>Happy hacking!</p><p><em>See the <a href="#appendix-examples">Appendix below</a> for miscellaneous <a href="#log-analytics--diagnostics-query">logging</a>, <a href="#url-rewrite">URL rewriting</a>, <a href="#afd-cli-commands">AFD CLI</a>, and <a href="#arm-null-property-and-terraform">ARM template examples</a></em></p><h2 id="appendix-examples"><span class="mr-2">Appendix: Examples</span><a href="#appendix-examples" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="log-analytics--diagnostics-query"><span class="mr-2">Log Analytics / Diagnostics Query</span><a href="#log-analytics--diagnostics-query" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This assumes you have a <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/diagnostic-settings?tabs=CMD">Diagnostics Settings created</a> that captures <code class="language-plaintext highlighter-rouge">FrontDoorAccessLog</code> logs and sends to a Log Analytics resource.</p><p>See the below for an example Log Analytics / Diagnostics query to find non-200 HTTP Status Codes</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>AzureDiagnostics
 | where httpStatusCode_s != 200 
    and TimeGenerated &gt; ago(500m)
</pre></table></code></div></div><h3 id="url-rewrite"><span class="mr-2">URL Rewrite</span><a href="#url-rewrite" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>See the below sections for examples on how to do URL Rewriting in .NET (.NET Core) App Services and Function Apps</p><h4 id="net---startupcs"><span class="mr-2">.NET - startup.cs</span><a href="#net---startupcs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Rewrite</span><span class="p">;</span>  <span class="c1">// add this using</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">,</span> <span class="n">IWebHostEnvironment</span> <span class="n">env</span><span class="p">,</span> <span class="n">ILoggerFactory</span> <span class="n">loggerFactory</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// url rewrite</span>
    <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RewriteOptions</span><span class="p">().</span><span class="nf">AddRewrite</span><span class="p">(</span><span class="s">@"^myapi/(.*)"</span><span class="p">,</span> <span class="s">"$1"</span><span class="p">,</span> 
                  <span class="n">skipRemainingRules</span><span class="p">:</span> <span class="k">true</span><span class="p">);</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseRewriter</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>
    
    <span class="p">...</span> <span class="c1">// remainder of code below</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>Note: This makes the URL for local development something like <code class="language-plaintext highlighter-rouge">http://localhost:5001/myapi/...</code></p></blockquote><blockquote><p>Note: If you need <code class="language-plaintext highlighter-rouge">/path</code> and <code class="language-plaintext highlighter-rouge">/path/</code> to work, then the regex for the rewrite should be <code class="language-plaintext highlighter-rouge">@"^myapi[/]?(.*)"</code></p></blockquote><h4 id="net---swagger"><span class="mr-2">.NET - Swagger</span><a href="#net---swagger" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>If you are using Swagger for an API, you should also update the prefix for the Swagger endpoint:</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>
<span class="c1">// Enable middleware to serve generated Swagger as a JSON endpoint.</span>
<span class="n">app</span><span class="p">.</span><span class="nf">UseSwagger</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseSwaggerUI</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span>
<span class="p">{</span>
   <span class="c1">// Specify swagger JSON endpoint</span>
   <span class="kt">var</span> <span class="n">prefix</span> <span class="p">=</span> <span class="n">apiPath</span> <span class="p">==</span> <span class="s">""</span> <span class="p">?</span> <span class="s">""</span> <span class="p">:</span> <span class="s">$"/</span><span class="p">{</span><span class="n">apiPath</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
   <span class="n">c</span><span class="p">.</span><span class="nf">SwaggerEndpoint</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">prefix</span><span class="p">}</span><span class="s">/swagger/</span><span class="p">{</span><span class="n">apiVersion</span><span class="p">}</span><span class="s">/swagger.json"</span><span class="p">,</span> <span class="n">apiDefinitionTitle</span><span class="p">);</span>
   <span class="n">c</span><span class="p">.</span><span class="nf">DocExpansion</span><span class="p">(</span><span class="n">DocExpansion</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>
   <span class="c1">// specifying the Swagger-ui endpoint.</span>
   <span class="n">c</span><span class="p">.</span><span class="n">RoutePrefix</span> <span class="p">=</span> <span class="s">"swagger-ui"</span><span class="p">;</span>
   <span class="n">c</span><span class="p">.</span><span class="nf">DefaultModelsExpandDepth</span><span class="p">(-</span><span class="m">1</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><h4 id="function-apps---hostjson"><span class="mr-2">Function Apps - host.json</span><a href="#function-apps---hostjson" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext filepath highlighter-rouge">host.json</code>:</p><div file="host.json" class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="host.json"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w">  
  </span><span class="nl">"extensions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"http"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"routePrefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"function1"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h3 id="afd-cli-commands"><span class="mr-2">AFD CLI Commands</span><a href="#afd-cli-commands" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="delete-origin-group"><span class="mr-2">Delete Origin Group</span><a href="#delete-origin-group" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">az afd origin-group delete --profile-name my-afd --resource-group my-afd-rg --origin-group-name myorigingroup --yes
</span></pre></table></code></div></div><h4 id="delete-custom-domain"><span class="mr-2">Delete Custom Domain</span><a href="#delete-custom-domain" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">az afd custom-domain delete --profile-name my-afd --resource-group my-afd-rg --custom-domain-name mysubdomain.mydomain.net
</span></pre></table></code></div></div><h4 id="delete-route"><span class="mr-2">Delete Route</span><a href="#delete-route" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">az afd route delete --profile-name my-afd --resource-group my-afd-rg --endpoint-name my-endpoint --route default
</span></pre></table></code></div></div><h4 id="delete-endpoint"><span class="mr-2">Delete Endpoint</span><a href="#delete-endpoint" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">az afd endpoint delete --profile-name my-afd --resource-group my-afd-rg --endpoint-name my-endpoint
</span></pre></table></code></div></div><h4 id="show-endpoint"><span class="mr-2">Show Endpoint</span><a href="#show-endpoint" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">az afd endpoint show --profile-name my-afd --resource-group my-afd-rg --endpoint-name my-endpoint
</span></pre></table></code></div></div><h4 id="adding-custom-domain-with-certificate"><span class="mr-2">Adding Custom Domain with Certificate</span><a href="#adding-custom-domain-with-certificate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Note that when <code class="language-plaintext highlighter-rouge">--custom-domain-name</code> asks for a name, it’s just the friendly name of the domain as it appears in AFD</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>az afd custom-domain create -my-afd-rg <span class="nt">--custom-domain-name</span> foobar --profile-my-afd <span class="nt">--host-name</span> <span class="s1">'*.mysubdomain.mydomain.com'</span> --minimum-tls-version TLS12 --certificate-type CustomerCertificate --secret my-wildcard-cert-pfx --debug
</pre></table></code></div></div><h4 id="purging-cache"><span class="mr-2">Purging Cache</span><a href="#purging-cache" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>az afd endpoint purge --ids <span class="s2">"/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/my-afd-rg/providers/Microsoft.Cdn/profiles/my-afd/afdendpoints/my-endpoint"</span> --content-paths <span class="s2">"/*"</span>
</pre></table></code></div></div><h3 id="arm-null-property-and-terraform"><span class="mr-2">ARM Null() property and Terraform</span><a href="#arm-null-property-and-terraform" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We couldn’t figure out a way to pass in <code class="language-plaintext highlighter-rouge">null()</code> from Terraform to our ARM template using the <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/template_deployment">azurerm_template_deployment</a> resource, and passing in <code class="language-plaintext highlighter-rouge">""</code> failed in mysterious ways or ended up just hanging the deployment. Essentially, we wrote some logic to convert the <code class="language-plaintext highlighter-rouge">""</code> passed into the template parameter to <code class="language-plaintext highlighter-rouge">null()</code> for us.</p><p>Note lines 20, 25, and 69 for the relevant logic:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"contentVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"profileName"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"originGroupsName"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"hostName"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"hostHeader"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"privateLinkResourceId"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"privateLinkResourceType"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"variables"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"is-private-link-service-type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[equals('', parameters('privateLinkResourceType'))]"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"is-null-host-header"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[equals('', parameters('hostHeader'))]"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"resources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Cdn/profiles/originGroups"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-01"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[concat(parameters('profileName'), '/', parameters('originGroupsName'))]"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"loadBalancingSettings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"sampleSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"successfulSamplesRequired"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"additionalLatencyInMilliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"healthProbeSettings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"probePath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"probeRequestType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HEAD"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"probeProtocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Http"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"probeIntervalInSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"sessionAffinityState"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Cdn/profiles/originGroups/origins"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-01"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[concat(parameters('profileName'), '/', parameters('originGroupsName'), '/default')]"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dependsOn"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"[resourceId('Microsoft.Cdn/profiles/originGroups', parameters('profileName'), parameters('originGroupsName'))]"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"hostName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('hostName')]"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"originHostHeader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[if(variables('is-null-host-header'), null(), parameters('hostHeader'))]"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"httpPort"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w">
                </span><span class="nl">"httpsPort"</span><span class="p">:</span><span class="w"> </span><span class="mi">443</span><span class="p">,</span><span class="w">
                </span><span class="nl">"priority"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nl">"weight"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
                </span><span class="nl">"enabledState"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"sharedPrivateLinkResource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"privateLinkLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[resourceGroup().location]"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"privateLink"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('privateLinkResourceId')]"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nl">"groupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[if(variables('is-private-link-service-type'), null(), parameters('privateLinkResourceType'))]"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"requestMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Private link service from AFD"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/azure/'>Azure</a>, <a href='/categories/front-door/'>Front Door</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/azure/" class="post-tag no-text-decoration" >Azure</a> <a href="/tags/azure-front-door/" class="post-tag no-text-decoration" >Azure Front Door</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Azure+Front+Door+Standard%2FPremium+Preview+-+Tips%2C+Tricks%2C+and+Lessons+Learned+-+josh-ops&url=https%3A%2F%2Fjosh-ops.com%2Fposts%2Fazure-frontdoor-preview-experience%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Azure+Front+Door+Standard%2FPremium+Preview+-+Tips%2C+Tricks%2C+and+Lessons+Learned+-+josh-ops&u=https%3A%2F%2Fjosh-ops.com%2Fposts%2Fazure-frontdoor-preview-experience%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fjosh-ops.com%2Fposts%2Fazure-frontdoor-preview-experience%2F&text=Azure+Front+Door+Standard%2FPremium+Preview+-+Tips%2C+Tricks%2C+and+Lessons+Learned+-+josh-ops" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fjosh-ops.com%2Fposts%2Fazure-frontdoor-preview-experience%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/github-container-jobs/">Docker Container Jobs in GitHub Actions</a><li><a href="/posts/actions-runner-controller-without-cert-manager/">Configure actions-runner-controller without cert-manager</a><li><a href="/posts/azdo-commit-message-validator-and-pr-linker-github-action/">Azure DevOps Commit Message Validator and PR Linker GitHub Action</a><li><a href="/posts/azure-devops-migrate-work-items/">Azure DevOps: Migrate Work Items to New Organization / Project</a><li><a href="/posts/github-misc-scripts/">Miscellaneous GitHub API/GraphQL/CLI Automation Scripts</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/github-actions/">GitHub Actions</a> <a class="post-tag" href="/tags/pull-requests/">Pull Requests</a> <a class="post-tag" href="/tags/github-advanced-security/">GitHub Advanced Security</a> <a class="post-tag" href="/tags/scripts/">Scripts</a> <a class="post-tag" href="/tags/work-items/">Work Items</a> <a class="post-tag" href="/tags/branch-protection-rules/">Branch Protection Rules</a> <a class="post-tag" href="/tags/dependabot/">Dependabot</a> <a class="post-tag" href="/tags/codeql/">CodeQL</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/azdo-commit-message-validator-and-pr-linker-github-action/"><div class="card-body"> <em class="small" data-ts="1660759200" data-df="ll" > Aug 17, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Azure DevOps Commit Message Validator and PR Linker GitHub Action</h3><div class="text-muted small"><p> Overview I was with a client recently that was using GitHub for source control and GitHub Advanced Security, and Azure DevOps for Boards and Pipelines. Integrating GitHub with Azure DevOps is rela...</p></div></div></a></div><div class="card"> <a href="/posts/github-script-to-add-users-to-teams/"><div class="card-body"> <em class="small" data-ts="1660251600" data-df="ll" > Aug 11, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GitHub: Script to Bulk Add Users to a Team</h3><div class="text-muted small"><p> Overview If you’ve ever had to add several users to a team in a GitHub organization, you know it can be a pain as it’s one user at a time and multiple clicks per add. This script aims to simplify ...</p></div></div></a></div><div class="card"> <a href="/posts/lap-around-github-advanced-security/"><div class="card-body"> <em class="small" data-ts="1659578400" data-df="ll" > Aug 3, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>A Lap Around GitHub Advanced Security (30m Video)</h3><div class="text-muted small"><p> Overview I realized that there wasn’t any content of me speaking on the internet, just blogging, so I thought I would at least create one! This is a video I created to explain the features of GitH...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/azure-devops-migrate-work-items/" class="btn btn-outline-primary" prompt="Older"><p>Azure DevOps: Migrate Work Items to New Organization / Project</p></a> <a href="/posts/azdo-angular-pipeline-caching/" class="btn btn-outline-primary" prompt="Newer"><p>Working Azure DevOps Pipeline Caching for Angular CI</p></a></div><script src="https://utteranc.es/client.js" repo="joshjohanning/joshjohanning.github.io" issue-term="title" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/joshjohanning">Josh Johanning</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/github-actions/">GitHub Actions</a> <a class="post-tag" href="/tags/pull-requests/">Pull Requests</a> <a class="post-tag" href="/tags/github-advanced-security/">GitHub Advanced Security</a> <a class="post-tag" href="/tags/scripts/">Scripts</a> <a class="post-tag" href="/tags/work-items/">Work Items</a> <a class="post-tag" href="/tags/branch-protection-rules/">Branch Protection Rules</a> <a class="post-tag" href="/tags/dependabot/">Dependabot</a> <a class="post-tag" href="/tags/codeql/">CodeQL</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GE92ZJY22K"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GE92ZJY22K'); }); </script>
